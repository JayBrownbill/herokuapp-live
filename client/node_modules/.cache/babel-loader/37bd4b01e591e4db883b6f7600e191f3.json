{"ast":null,"code":"'use strict';\n\nvar urllib = require('url');\n\nmodule.exports.CookieJar = CookieJar;\n\nfunction CookieJar(options) {\n  this.options = options || {};\n  this.options.sessionTimeout = this.options.sessionTimeout || 1800; // 30min\n\n  this.cookies = {};\n}\n\nCookieJar.prototype.addCookie = function (cookie) {\n  if (!cookie || !cookie.name) {\n    return;\n  }\n\n  var lcookie;\n\n  if (!this.cookies[cookie.name]) {\n    this.cookies[cookie.name] = [];\n  } // overwrite if has same params\n\n\n  for (var i = 0, len = this.cookies[cookie.name].length; i < len; i++) {\n    lcookie = this.cookies[cookie.name][i];\n\n    if (lcookie.path === cookie.path && lcookie.domain === cookie.domain && lcookie.secure === cookie.secure && lcookie.httponly === cookie.httponly) {\n      this.cookies[cookie.name][i] = cookie;\n      return;\n    }\n  }\n\n  this.cookies[cookie.name].push(cookie);\n};\n\nCookieJar.prototype.getCookies = function (url) {\n  var keys = Object.keys(this.cookies),\n      cookie,\n      cookies = [];\n\n  for (var i = 0, len = keys.length; i < len; i++) {\n    if (Array.isArray(this.cookies[keys[i]])) {\n      for (var j = 0, lenj = this.cookies[keys[i]].length; j < lenj; j++) {\n        cookie = this.cookies[keys[i]][j];\n\n        if (this.matchCookie(cookie, url)) {\n          cookies.push(cookie.name + '=' + cookie.value);\n        }\n      }\n    }\n  }\n\n  return cookies.join('; ');\n};\n\nCookieJar.prototype.matchCookie = function (cookie, url) {\n  var urlparts = urllib.parse(url || '', false, true),\n      path; // check expire\n\n  if (cookie.expire) {\n    if (cookie.expire.getTime() < Date.now()) {\n      return;\n    }\n  } // check if hostname matches\n\n\n  if (urlparts.hostname && cookie._domain) {\n    if (!(urlparts.hostname === cookie._domain || urlparts.hostname.substr(-(cookie._domain.length + 1)) === '.' + cookie._domain)) {\n      return false;\n    }\n  } // check if path matches\n\n\n  if (cookie.path && urlparts.pathname) {\n    path = (urlparts.pathname || '/').split('/');\n    path.pop();\n    path = path.join('/').trim();\n\n    if (path.substr(0, 1) !== '/') {\n      path = '/' + path;\n    }\n\n    if (path.substr(-1) !== '/') {\n      path += '/';\n    }\n\n    if (path.substr(0, cookie.path.length) !== cookie.path) {\n      return false;\n    }\n  } // check secure\n\n\n  if (cookie.secure && urlparts.protocol) {\n    if (urlparts.protocol !== 'https:') {\n      return false;\n    }\n  } // check httponly\n\n\n  if (cookie.httponly && urlparts.protocol) {\n    if (urlparts.protocol !== 'http:') {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nCookieJar.prototype.setCookie = function (cookie_str, url) {\n  var parts = (cookie_str || '').split(';'),\n      cookie = {},\n      urlparts = urllib.parse(url || '', false, true),\n      path;\n  parts.forEach(function (part) {\n    var key, val;\n    part = part.split('=');\n    key = part.shift().trim();\n    val = part.join('=').trim();\n\n    if (!key) {\n      return;\n    }\n\n    switch (key.toLowerCase()) {\n      case 'expires':\n        cookie.expires = new Date(val);\n        break;\n\n      case 'path':\n        cookie.path = val.trim();\n        break;\n\n      case 'domain':\n        cookie.domain = val.toLowerCase();\n        break;\n\n      case 'max-age':\n        cookie.expires = new Date(Date.now() + (Number(val) || 0) * 1000);\n        break;\n\n      case 'secure':\n        cookie.secure = true;\n        break;\n\n      case 'httponly':\n        cookie.httponly = true;\n        break;\n\n      default:\n        if (!cookie.name) {\n          cookie.name = key;\n          cookie.value = val;\n        }\n\n    }\n  }.bind(this)); // use current path when path is not specified\n\n  if (!cookie.path) {\n    path = (urlparts.pathname || '/').split('/');\n    path.pop();\n    cookie.path = path.join('/').trim();\n\n    if (cookie.path.substr(0, 1) !== '/') {\n      cookie.path = '/' + cookie.path;\n    }\n\n    if (cookie.path.substr(-1) !== '/') {\n      cookie.path += '/';\n    }\n  } // if no expire date, then use sessionTimeout value\n\n\n  if (!cookie.expires) {\n    cookie._expires = new Date(Date.now() + (Number(this.options.sessionTimeout) || 0) * 1000);\n  } else {\n    cookie._expires = cookie.expires;\n  }\n\n  if (!cookie.domain) {\n    if (urlparts.hostname) {\n      cookie._domain = urlparts.hostname;\n    }\n  } else {\n    cookie._domain = cookie.domain;\n  }\n\n  this.addCookie(cookie);\n};","map":null,"metadata":{},"sourceType":"script"}